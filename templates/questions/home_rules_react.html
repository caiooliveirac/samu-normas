{% load static %}
{% load vite %}
{% vite_hmr as hmr %}
{% vite_dev_url as vite_url %}
<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8">
  <title>Manual de Normas SAMU</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  {% comment %}
    Canonical/OG URL:
    Em produção o app roda sob /manual/ e o Nginx envia X-Forwarded-Prefix.
    O WhatsApp associa o preview à og:url — se divergir da URL compartilhada,
    pode gerar comportamento estranho no WebView.
  {% endcomment %}
  {% with prefix=request.META.HTTP_X_FORWARDED_PREFIX|default:'' %}
    {% with canonical_path=prefix|add:'/' %}
      <link rel="canonical" href="{{ request.scheme }}://{{ request.get_host }}{{ canonical_path }}" />
      <meta property="og:url" content="{{ request.scheme }}://{{ request.get_host }}{{ canonical_path }}">
    {% endwith %}
  {% endwith %}

  <meta property="og:type" content="website">
  <meta property="og:title" content="Manual de Normas e Rotinas Médicas do SAMU">
  <meta property="og:description" content="Estabelece diretrizes técnicas, operacionais e administrativas para a atuação da equipe médica nas atividades de regulação e intervenção.">
  <meta property="og:image" content="https://mnrs.com.br/static/og/mnrs-og-v2.png">
  <meta property="og:image:type" content="image/png">
  <meta property="og:image:width" content="1536">
  <meta property="og:image:height" content="1024">
  <meta property="og:image:alt" content="Manual de Normas e Rotinas Médicas do SAMU">

  {% if hmr %}
    <script type="module">
      import RefreshRuntime from "{{ vite_url }}/@react-refresh"
      RefreshRuntime.injectIntoGlobalHook(window)
      window.$RefreshReg$ = () => {}
      window.$RefreshSig$ = () => (type) => type
      window.__vite_plugin_react_preamble_installed__ = true
    </script>
    <script type="module" src="{{ vite_url }}/@vite/client"></script>
  {% endif %}
  {% if not hmr %}
    {% vite_css 'src/main.jsx' as css %}
    {% if css %}
      <link rel="stylesheet" href="{{ css }}" />
    {% endif %}
  {% endif %}
</head>
<body>
  <div id="root">
    <!-- React monta aqui -->
    <div class="container"><p class="muted">Carregando…</p></div>
  </div>

  {% if hmr %}
    <script type="module" src="{{ vite_url }}/src/main.jsx"></script>
  {% else %}
    {# carrega o bundle resolvido via manifest do Vite #}
    <script src="{% vite_asset 'src/main.jsx' %}" type="module"></script>
  {% endif %}
</body>
</html>
